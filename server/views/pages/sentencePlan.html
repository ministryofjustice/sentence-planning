{% extends "../partials/offenderDetailsLayout.html" %}

{% from "button/macro.njk" import govukButton %}
{% from "tabs/macro.njk" import govukTabs %}

{% block content %}
<script>
  const changeOrder = function(stepId, by){
    step = document.getElementById(`step${stepId}`)
    if(by < 0) return step.parentNode.insertBefore(step.nextElementSibling, step)
    return step.parentNode.insertBefore(step, step.previousElementSibling)

  }
</script>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h1 class="govuk-heading-xl">Plan overview</h1>
  </div>

  {% set currentStepsHtml %}
    {% if steps.length > 0 %}
      <table class="govuk-table table-layout-fixed sentence-plan-step-table">
        <colgroup>
          <col class="sentence-plan-table-step">
          <col>
          <col>
          <col>
          <col class="sentence-plan-table-move">
        </colgroup>
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-table__header" scope="col">Step</th>
            <th class="govuk-table__header" scope="col">Status</th>
            <th class="govuk-table__header nowrap" scope="col">Last update</th>
            <th class="govuk-table__header"></th>
            <th class="govuk-table__header table-column-align-center" scope="col">Move</th>
          </tr>
        </thead>
        <tbody class="govuk-table__body">
          {% for step in steps %}
            {% set rootUrl %}/sentence-plan/oasys-offender-id/{{oasysOffenderId}}/sentence-plan/{{sentencePlanId}}/step/{{step.stepId}}{% endset %}
            <tr class="govuk-table__row" id="step{{step.stepId}}">
              <td class="govuk-table__cell table-column-clip-text"><a href="{{rootUrl}}/view" class="govuk-link">{{step.step}}</a></td>
              <td class="govuk-table__cell nowrap">{{step.status}}</td>
              <td class="govuk-table__cell nowrap">{{step.lastUpdate}}</td>
              <td class="govuk-table__cell nowrap">
                  {{ govukButton({
                    text: "Progress",
                    classes: "govuk-!-margin-right-1 govuk-!-margin-bottom-0",
                    href: rootUrl+"/progress"
                  }) }}
                </span>
              </td>
              <td class="govuk-table__cell govuk-ordered-table-buttons table-column-align-center">
                <button type="button" class="govuk-ordered-table-icon" onclick="changeOrder({{step.stepId}}, 1)">
                  <span class="govuk-ordered-table-icon__up"></span>
                </button>
                <button type="button" class="govuk-ordered-table-icon" onclick="changeOrder({{step.stepId}}, -1)">
                  <span class="govuk-ordered-table-icon__down"></span>
                </button>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      There are currently no current steps.
    {% endif %}
  {% endset %}
  {% set pastStepsHtml %}
    {% if pastSteps.length > 0 %}
      <table class="govuk-table sentence-plan-step-table">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-table__header" scope="col">Step</th>
            <th class="govuk-table__header" scope="col">Status</th>
            <th class="govuk-table__header nowrap" scope="col">Last update</th>
          </tr>
        </thead>
        <tbody class="govuk-table__body">
          {% for step in pastSteps %}
            {% set rootUrl %}/sentence-plan/oasys-offender-id/{{oasysOffenderId}}/sentence-plan/{{sentencePlanId}}/step/{{step.stepId}}{% endset %}
            <tr class="govuk-table__row" id="step{{step.stepId}}">
              <td class="govuk-table__cell"><a href="{{rootUrl}}/view" class="govuk-link">{{step.step}}</a></td>
              <td class="govuk-table__cell nowrap">{{step.status}}</td>
              <td class="govuk-table__cell nowrap">{{step.lastUpdate}}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      There are currently no past steps.
    {% endif %}
  {% endset %}
  {{ govukTabs({
    items: [
      {
        label: "Current",
        id: "current-steps",
        panel: {
          html: currentStepsHtml
        }
      },
      {
        label: "Past",
        id: "past-steps",
        panel: {
          html: pastStepsHtml
        }
      }
    ]
  }) }}

  {{ govukButton({
    text: "Add new step",
    classes: "govuk-!-margin-right-1 govuk-grid-column-one-half",
    href: "/sentence-plan/oasys-offender-id/" + oasysOffenderId + "/sentence-plan/" + sentencePlanId + "/step/new"
  }) }}
  {{ govukButton({
    text: "My progress",
    classes: "govuk-!-margin-right-1 govuk-grid-column-one-half",
    href: "/sentence-plan/oasys-offender-id/" + oasysOffenderId + "/sentence-plan/" + sentencePlanId + "/summary"
  }) }}
</div>
{% endblock %}
